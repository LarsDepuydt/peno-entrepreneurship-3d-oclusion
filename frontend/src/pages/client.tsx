import { sendVR } from '@/gen/proto/threedoclusion/v1/service-ScanService_connectquery'
import { useQuery } from '@tanstack/react-query';
import { useState, useEffect } from 'react';


export default function ClientPage() {
    let scanId = 111 // Should be generated by clicking on certain scan
    const [clientId, setClientId] = useState<number | undefined>(undefined);
    const [submitOK, setSubmitOK] = useState(false);
    
    const query = sendVR.useQuery({ clientId, scanId });
    const { data, refetch } = useQuery(query.queryKey, query.queryFn, { enabled: false });

    function afterSubmit(event: React.FormEvent<HTMLFormElement>) {
      event.preventDefault();
      let codeInput = document.getElementById("code") as HTMLInputElement | null;
  
      if (codeInput){
        setClientId(parseInt(codeInput.value, 10));
      }
      setSubmitOK(true);
    }

    const handleRedirect = () => {
       if (submitOK){
        refetch();
        setSubmitOK(false);
        //console.log(data); // Undefined?
       }
    };

  return (
    <div>
      <h1>Client Page</h1>
      <form onSubmit={afterSubmit}>
        Code: <input type="text" id="code" size={20} name="code"/><br/>
        <input type="submit" value="Submit"/> 
      </form>
      <button id="redirect-button" onClick={handleRedirect}>Send to VR</button>
    </div>
  )
}